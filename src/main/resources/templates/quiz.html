<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="_csrf" th:content="${_csrf.token}">
	<meta name="_csrf_header" th:content="${_csrf.headerName}">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>퀴즈 풀이</title>
	<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">
	<link th:href="@{/vendor/fontawesome-free/css/all.min.css}" rel="stylesheet" type="text/css" />
	<link th:href="@{/css/sb-admin-2.css}" rel="stylesheet" />
	<link th:href="@{/css/quiz.css}" rel="stylesheet" />
	<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/stompjs/lib/stomp.min.js"></script>

</head>

<body class="bg-gradient-success" th:attr="data-room-code=${roomCode},
         data-total-questions=${totalQuestions},
		 data-user-id=${effectiveUserId}">

	<div class="container-fluid py-4">
		<div class="d-flex justify-content-between align-items-center mb-3">

			<a class="d-flex align-items-center text-decoration-none">
				<div class="rotate-n-15">
					<img src="/img/app_icon.png" style="width: 40px; height: 40px;">
				</div>
				<div class="mx-2 font-weight-bold text-white"
					style="font-size: 2.3rem; font-family: 'Fredoka', sans-serif;">
					Quinect
				</div>
			</a>

			<!-- 여기다가 작업하시면 됩니다 나가는거 -->
			<a th:href="@{/}" class="text-decoration-none d-flex flex-column align-items-center"
				onclick="return confirm('정말 퀴즈에서 나가시겠습니까?');"
				onmouseover="this.querySelector('i').classList.replace('fa-door-closed', 'fa-door-open')"
				onmouseout="this.querySelector('i').classList.replace('fa-door-open', 'fa-doㅉor-closed')">

				<i class="fas fa-door-closed text-white" style="font-size: 1.8rem"></i>

				<span class="text-white small font-weight-bold mt-1">나가기</span>
			</a>

		</div>
		<!-- 헤더 -->
		<div class="card shadow mb-4 quiz-header">
			<div class="card-body p-4">
				<div class="d-flex justify-content-between align-items-center mb-3">
					<div>
						<span class="text-white-50">🔑 방 코드:</span>
						<span class="h4 font-weight-bold" th:text="${roomCode}">ABCD</span>
					</div>
					<div class="text-white font-weight-bold fs-5">
						문제 <span id="current-question">1</span> / <span th:text="${totalQuestions}"></span>
					</div>
				</div>
				<div class="progress-bar-quiz">
					<div class="progress-fill" id="progress-bar" style="width: 0%;"></div>
				</div>
			</div>
		</div>

		<!-- 메인 콘텐츠 -->
		<div class="row">
			<!-- 문제 영역 -->
			<div class="col-lg-8">
				<div class="card shadow mb-4">
					<div id="error-message" class="alert alert-danger m-3" role="alert" style="display: none;"></div>

					<div id="loading-state" class="card-body text-center py-5">
						<div class="spinner"></div>
						<p class="text-muted mt-3 fs-5">문제를 불러오는 중...</p>
					</div>

					<div id="question-area" class="card-body" style="display: none;">
						<div class="mb-4">
							<div class="question-text" id="question-text"></div>
							<img id="question-image" class="question-image" style="display: none;" src="" alt="문제 이미지">
							<span class="badge badge-success px-3 py-2" id="point-badge"
								style="font-size: 15px;"></span>
						</div>

						<div id="options-container" style="display: none;"></div>

						<div id="textarea-container" style="display: none;" class="mb-4">
							<textarea id="answer-textarea" class="form-control answer-textarea"
								placeholder="답을 입력하세요..."></textarea>
							<div class="autosave-indicator" id="autosave-status">임시 저장 중...</div>
						</div>

						<div class="text-right mt-4">
							<button class="btn btn-success btn-lg fs-5" id="submit-btn" onclick="submitAnswer()"
								style="font-size: 18px; padding: 12px 30px;">
								<i class="fas fa-paper-plane"></i> 제출
							</button>
						</div>
					</div>
				</div>
			</div>

			<!-- 실시간 순위 -->
			<div class="col-lg-4">
				<div class="card shadow mb-4" id="ranking-container" style="display: none;">
					<div class="card-header bg-info py-3">
						<h6 class="m-0 font-weight-bold text-white fs-5">
							<i class="fas fa-chart-bar mr-2"></i>실시간 순위
						</h6>
					</div>
					<div class="card-body p-3">
						<div id="ranking-list"></div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script th:src="@{/vendor/jquery/jquery.min.js}"></script>
	<script th:src="@{/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/js/quiz.js}"></script>
</body>

</html>