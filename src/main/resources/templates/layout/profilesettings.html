<div class="settings-container" th:fragment="profilesettings">

	<div class="d-flex align-items-center justify-content-between mb-3">
		<div class="d-flex align-items-center">
			<a th:href="${source == 'main'} ? @{/main} : @{/profile}" class="text-decoration-none text-gray-800 mr-3">
				<i class="fas fa-arrow-left fa-2x"></i>
			</a>
			<h1 class="h3 mb-0 text-gray-800 font-weight-bold">설정</h1>
		</div>
	</div>

	<hr class="mb-4">

	<div class="row">
		<div class="col-md-3 mb-4">
			<div class="nav flex-column nav-pills settings-nav" id="v-pills-tab" role="tablist"
				aria-orientation="vertical">
				<span class="small text-gray-600 font-weight-bold text-uppercase px-3 mb-2 mt-2">프로필 설정</span>

				<a class="nav-link active" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-profile"
					role="tab" aria-controls="v-pills-profile" aria-selected="true">
					<i class="fas fa-user mr-2"></i> 기본 정보
				</a>
				<a class="nav-link" id="v-pills-theme-tab" data-toggle="pill" href="#v-pills-theme" role="tab"
					aria-controls="v-pills-theme" aria-selected="false">
					<i class="fas fa-palette mr-2"></i> 테마 변경
				</a>

				<hr class="w-100 my-3" style="border-color: #eaecf4;">

				<span class="small text-gray-600 font-weight-bold text-uppercase px-3 mb-2">일반 설정</span>
				<a class="nav-link" id="v-pills-general-tab" data-toggle="pill" href="#v-pills-general" role="tab"
					aria-controls="v-pills-general" aria-selected="false">
					<i class="fas fa-cog mr-2"></i> 일반
				</a>
			</div>
		</div>

		<div class="col-md-9">
			<div class="tab-content settings-content" id="v-pills-tabContent">

				<div class="tab-pane fade show active" id="v-pills-profile" role="tabpanel"
					aria-labelledby="v-pills-profile-tab">
					<form id="settingsForm" enctype="multipart/form-data">
						<h5 class="font-weight-bold text-gray-800 mb-4">기본 프로필 정보</h5>

						<div class="form-group">
							<label class="form-label">닉네임</label>
							<input type="text" class="form-control" name="username"
								th:value="${user.userProfile.username}" required>
						</div>

						<div class="form-group">
							<label class="form-label">소속</label>
							<input type="text" class="form-control" name="organization"
								th:value="${user.userProfile.organization}">
						</div>

						<div class="form-group">
							<label class="form-label">한줄 소개 (Bio)</label>
							<input type="text" class="form-control" name="bio" th:value="${user.userProfile.bio}">
						</div>

						<div class="form-group mt-4">
							<label class="form-label">프로필 사진 변경</label>
							<div class="d-flex align-items-center">
								<div class="mr-3">
									<img id="profilePreview"
										th:src="${user.userProfile.profileImage != null ? user.userProfile.profileImage : '/img/default_profile.png'}"
										class="rounded-circle"
										style="width: 80px; height: 80px; object-fit: cover; border: 1px solid #ddd;">
								</div>
								<div class="custom-file">
									<input type="file" class="custom-file-input" id="profileImageFile"
										name="profileImageFile" accept="image/*" onchange="previewImage(this)">
									<label class="custom-file-label" for="profileImageFile" data-browse="찾기">사진
										선택...</label>
								</div>
							</div>
							<small class="text-muted ml-2">권장 크기: 500x500px, 2MB 이하</small>
						</div>

						<div class="text-right mt-4">
							<button type="button" onclick="saveViaAjax('settingsForm', '/profile/settings/profilesave')"
								class="btn btn-success btn-icon-split">
								<span class="icon text-white-50"><i class="fas fa-save"></i></span>
								<span class="text">변경사항 저장</span>
							</button>
						</div>
					</form>
				</div>

				<div class="tab-pane fade" id="v-pills-theme" role="tabpanel" aria-labelledby="v-pills-theme-tab">

					<h5 class="font-weight-bold text-gray-800 mb-3">테두리 선택</h5>
					<div class="row mb-4" id="borderSection">
						<div class="col-3 mb-2">
							<div class="selection-box default-box" data-id="" onclick="selectItem('border', '', this)">
								<div style="height: 50px; display: flex; align-items: center; justify-content: center;">
									<i class="fas fa-ban fa-2x text-gray-400"></i>
								</div>
								<div class="small mt-2">기본</div>
							</div>
						</div>
						<div class="col-3 mb-2" th:each="inven : ${myBorders}">
							<div class="selection-box" th:classappend="${inven.equipped} ? 'active' : ''"
								th:data-id="${inven.item.id}"
								th:onclick="|selectItem('border', '${inven.item.id}', this)|">

								<img th:if="${inven.item.imageUrl}" th:src="${inven.item.imageUrl}" class="mb-2"
									style="width: 50px; height: 50px;">
								<i th:unless="${inven.item.imageUrl}"
									class="fas fa-certificate fa-2x mb-2 text-primary"></i>
								<div class="small" th:text="${inven.item.itemName}">이름</div>
							</div>
						</div>
					</div>

					<hr>

					<h5 class="font-weight-bold text-gray-800 mb-3">테마 선택</h5>
					<div class="row" id="themeSection">
						<div class="col-3 mb-2">
							<div class="selection-box default-box" data-id="" onclick="selectItem('theme', '', this)">
								<div style="height: 50px; background-color: #f8f9fc; border: 1px solid #ddd;"></div>
								<div class="small mt-2">기본</div>
							</div>
						</div>
						<div class="col-3 mb-2" th:each="inven : ${myThemes}">
							<div class="selection-box" th:classappend="${inven.equipped} ? 'active' : ''"
								th:data-id="${inven.item.id}"
								th:onclick="|selectItem('theme', '${inven.item.id}', this)|">

								<img th:if="${inven.item.imageUrl}" th:src="${inven.item.imageUrl}" class="mb-2"
									style="width: 100%; height: 50px; object-fit: cover;">
								<div style="height: 50px; background-color: #eee;" th:unless="${inven.item.imageUrl}">
								</div>
								<div class="small" th:text="${inven.item.itemName}">이름</div>
							</div>
						</div>
					</div>

					<div class="text-right mt-4">
						<button type="button" onclick="submitEquipForm()" class="btn btn-success btn-icon-split">
							<span class="icon text-white-50"><i class="fas fa-save"></i></span>
							<span class="text">변경사항 저장</span>
						</button>
					</div>
				</div>

				<div class="tab-pane fade" id="v-pills-general" role="tabpanel" aria-labelledby="v-pills-general-tab">
				</div>

			</div>
		</div>
	</div>
	<input type="hidden" id="inputBorderId">
	<input type="hidden" id="inputThemeId">
	<form id="equipForm" enctype="application/x-www-form-urlencoded">
		<input type="hidden" name="borderId" id="realBorderId">
		<input type="hidden" name="themeId" id="realThemeId">
	</form>
</div>