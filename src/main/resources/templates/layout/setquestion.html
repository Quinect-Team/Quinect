<style>
	/* 문제 블록 전체 */
	#question-container {
	    max-width: 900px;
	    margin: 0 auto;
	    padding: 0 20px;
	    box-sizing: border-box;
	}

	.question-block {
	    border: 1px solid #ccc;
	    padding: 20px;
	    border-radius: 8px;
	    background: #f8f9fa;
	    margin: 20px auto;
	}

	.question-block input[type="text"] {
	    padding: 8px;
	    width: 100%;
	    border: 1px solid #adb5bd;
	    border-radius: 6px;
	}
	.question-block input[type="text"]:focus {
	    outline: none;
	    border-color: #6c757d;
	    box-shadow: 0 0 0 3px rgba(108,117,125,0.25);
	}

	.choice-buttons {
	    display: flex;
	    gap: 10px;
	    margin-top: 10px;
	}
	
	/* 문제 추가 버튼 */
	.add-question-area {
	    max-width: 900px;
	    margin: 0 auto;
	    display: flex;
	    gap: 10px;
	    justify-content: flex-end;
	}
	.add-question-area button {
	    width: 150px;
	    height: 40px;
	}
	
	/* 선지 추가 버튼 */
	#choices {
		padding: 8px;
		display: flex;
		margin-top: 10px;
		padding-right: 20px;
	}

	/* 문제 추가 버튼 */
	.submit-area {
	    max-width: 900px;
	    margin: 0 auto;
	    display: flex;
	    gap: 10px;
	    justify-content: flex-end;
		margin-top: 10px;
	}
	.submit-area button {
	    width: 150px;
	    height: 40px;
	}
	
	#question-sub{
		max-width: 900px;
		margin: 0 auto;
		padding: 0 20px;
		box-sizing: border-box;
	}
</style>


<!-- 부트스트랩 -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<div id="question-sub" style="margin-bottom:20px;">
    <input type="text" id="quiz-title" placeholder="퀴즈 제목을 입력하세요" style="width:100%; padding:10px; margin-bottom:10px;">
    <textarea id="quiz-desc" placeholder="퀴즈 설명을 입력하세요(선택)" style="width:100%; padding:10px;"></textarea>
</div>

<div id="question-container">

	<div class="question-block">
		<div class="d-flex align-items-center" style="gap:10px;">
	        <label class="q-label" for="question" style="margin:0; font-weight:bold;">Q1.</label>

	        <input type="text" name="question" placeholder="문제를 입력하세요" style="flex:1;">
			
			<input type="text" name="point" placeholder="점수" style="flex:0.1;">

	        <div class="btn-group dropright">
			  <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">
			    문제 유형
			  </button>
			  <div class="dropdown-menu">
			    <a class="dropdown-item select-type" data-type="short_answer" href="#">서술형</a>
			    <a class="dropdown-item select-type" data-type="multiple_choice" href="#">객관식</a>
			  </div>
			</div>
	    </div>

	    <div class="text-container" style="margin-top:10px;">
	        <input type="text" name="sub" placeholder="지문을 작성하세요" style="width:100%; padding:5px;">

	    </div>
	</div>
</div>

<!-- 문제 추가 -->
<div class="add-question-area">
    <button id="add-question" class="btn btn-secondary">문제 추가</button>
    <button id="remove-question" class="btn btn-secondary">문제 제거</button>
</div>
<div class="submit-area">
    <button id="temp-save" class="btn btn-secondary">임시 저장</button>
    <button id="save" class="btn btn-secondary">저장</button>
</div>

<!-- Bootstrap & Script -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>


<script>
	function collectQuizData() {
	    const quizData = {
	        title: document.getElementById('quiz-title').value,
	        description: document.getElementById('quiz-desc').value,
	        questions: []
	    };

	    const blocks = document.querySelectorAll('.question-block');

	    blocks.forEach((block, i) => {
	        const questionText = block.querySelector('input[name="question"]').value;
	        const typeMenu = block.querySelector('.dropdown-toggle').innerText.trim();
	        const isObjective = typeMenu.includes("객관식");

	        const subContainer = block.querySelector('.text-container');
	        const inputs = subContainer.querySelectorAll('input');

	        let options = [];
	        if (isObjective) {
	            inputs.forEach((inp, idx) => {
	                options.push({
	                    optionNumber: idx + 1,
	                    optionText: inp.value
	                });
	            });
	        }

	        quizData.questions.push({
	            questionText: questionText,
	            quizTypeCode: isObjective ? 2 : 1,
	            options: options
	        });
	    });

	    return quizData;
	}

	/* 버튼 클릭> 서버 전송 */
	document.getElementById('save').addEventListener('click', function () {
	    const quizData = collectQuizData();

	    fetch("/quiz/save", {
	        method: "POST",
	        headers: {"Content-Type": "application/json"},
	        body: JSON.stringify(quizData)
	    })
	    .then(res => res.text())
	    .then(msg => alert(msg));
	});

	document.getElementById('temp-save').addEventListener('click', function () {
	    const quizData = collectQuizData();
	    fetch("/quiz/temp-save", {
	        method: "POST",
	        headers: {"Content-Type": "application/json"},
	        body: JSON.stringify(quizData)
	    })
	    .then(res => res.text())
	    .then(msg => alert(msg));
	});

	/* 최초 로딩 시 실행 */
activateDropdown(document.querySelector('.question-block'));
</script>
