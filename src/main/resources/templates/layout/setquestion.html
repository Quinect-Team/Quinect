<script th:inline="javascript">
    const quizIdFromServer = /*[[${quizId}]]*/ null;
</script>

<div class="container mt-4" style="max-width: 1200px;" th:fragment="setquestion">

	<div class="modal fade" id="quizListModal" tabindex="-1" role="dialog">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">저장된 퀴즈 불러오기</h5>
					<button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
				</div>
				<div class="modal-body">
					<div id="quiz-list" class="list-group"></div>
				</div>
				<div class="modal-footer"><button class="btn btn-secondary" data-dismiss="modal">닫기</button></div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="aiCreateModal" tabindex="-1" role="dialog">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header bg-gradient-primary text-white">
					<h5 class="modal-title font-weight-bold" style="color:#fff;"><i class="fas fa-robot mr-2"></i>AI 퀴즈
						자동 생성</h5>
					<button type="button" class="close text-white" data-dismiss="modal"><span>&times;</span></button>
				</div>
				<div class="modal-body">
					<form id="ai-form">
						<div class="form-group">
							<label class="font-weight-bold">주제 (Topic)</label>
							<input type="text" id="ai-topic" class="form-control" placeholder="예: 한국사, 넌센스"
								maxlength="50">
						</div>
						<div class="form-group">
							<label class="font-weight-bold">난이도</label>
							<div class="btn-group btn-group-toggle w-100" data-toggle="buttons">
								<label class="btn btn-outline-primary active"><input type="radio" name="ai-difficulty"
										value="초급" checked> 초급</label>
								<label class="btn btn-outline-primary"><input type="radio" name="ai-difficulty"
										value="중급"> 중급</label>
								<label class="btn btn-outline-primary"><input type="radio" name="ai-difficulty"
										value="고급"> 고급</label>
							</div>
						</div>
						<div class="form-group">
							<label class="font-weight-bold">문제 개수</label>
							<div class="btn-group btn-group-toggle w-100" data-toggle="buttons">
								<label class="btn btn-outline-info active"><input type="radio" name="ai-count" value="3"
										checked> 3문제</label>
								<label class="btn btn-outline-info"><input type="radio" name="ai-count" value="6">
									6문제</label>
								<label class="btn btn-outline-info"><input type="radio" name="ai-count" value="10">
									10문제</label>
							</div>
						</div>
						<div class="form-group">
							<label class="font-weight-bold">문제 유형</label>
							<select id="ai-type" class="form-control">
								<option value="multiple">객관식 (4지선다)</option>
								<option value="short">서술형 (단답형)</option>
								<option value="mixed">혼합 (객관식 + 서술형)</option>
							</select>
						</div>
					</form>
					<div id="ai-loading" class="text-center mt-4" style="display:none;">
						<div class="spinner-border text-primary" role="status"><span class="sr-only">Loading...</span>
						</div>
						<p class="mt-2 text-primary font-weight-bold">AI가 문제를 출제 중입니다...</p>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
					<button type="button" class="btn btn-primary" id="btn-request-ai">생성하기</button>
				</div>
			</div>
		</div>
	</div>

	<div class="d-flex align-items-center mb-4" style="max-width: 900px; margin: 20px auto;">
		<a href="javascript:history.back()" class="text-decoration-none text-gray-800">
			<i class="fas fa-arrow-left fa-2x mr-2"></i>
		</a>
		<h1 id="page-title" class="h3 mb-0 text-gray-800 font-weight-bold">새 퀴즈 만들기</h1>
	</div>

	<div>
		<div id="question-sub" class="card shadow-sm border-0"
			style="max-width:900px; margin:0 auto 20px auto; padding: 20px; border-radius: 15px;">

			<div class="form-group mb-3">
				<label for="quiz-title" class="font-weight-bold text-gray-800 ml-1">퀴즈 제목</label>
				<div class="d-flex">
					<input id="quiz-title" type="text" class="form-control form-control-lg border-0 bg-light mr-2"
						placeholder="퀴즈 제목을 입력하세요" style="border-radius: 10px;">

					<button id="open-ai-modal" class="btn btn-info shadow-sm text-white d-flex align-items-center"
						style="min-width: 140px; justify-content: center; border-radius: 10px;">
						<i class="fas fa-magic mr-2"></i> AI로 생성
					</button>
				</div>
			</div>

			<div class="form-group mb-0">
				<label for="quiz-desc" class="font-weight-bold text-gray-800 ml-1">퀴즈 설명</label>
				<textarea id="quiz-desc" class="form-control border-0 bg-light" rows="2"
					placeholder="(선택사항)" style="border-radius: 10px; resize: none;"></textarea>
			</div>
		</div>

		<div id="question-container">
			<div class="question-block card shadow-sm mb-4 border-left-success" data-qid="1"
				style="max-width: 900px; margin: 0 auto 20px auto; border-radius: 10px; border-left-width: 5px !important;">
				<div class="card-body">
					<div class="d-flex align-items-center mb-3" style="gap:10px;">
						<span class="badge badge-success badge-pill px-3 py-2" style="font-size: 1rem;">Q1</span>

						<input type="text" class="form-control q-title font-weight-bold" placeholder="문제를 입력하세요"
							style="flex:1;">
						<input type="number" class="form-control q-point text-center" placeholder="점수" value="10"
							style="width:80px;">

						<div class="btn-group">
							<button type="button" class="btn btn-outline-secondary dropdown-toggle btn-sm"
								data-toggle="dropdown">
								<i class="fas fa-list-ul mr-1"></i>유형
							</button>
							<div class="dropdown-menu dropdown-menu-right shadow">
								<a class="dropdown-item select-type" data-type="short_answer" href="#"><i
										class="fas fa-pen mr-2 text-gray-400"></i>서술형</a>
								<a class="dropdown-item select-type" data-type="multiple_choice" href="#"><i
										class="fas fa-check-square mr-2 text-gray-400"></i>객관식</a>
							</div>
						</div>

						<button class="btn btn-outline-danger btn-sm delete-question" style="display:none;">
							<i class="fas fa-trash"></i>
						</button>
					</div>

					<div class="image-container mb-3 p-3 bg-light rounded text-center"
						style="border: 2px dashed #e3e6f0;">
						<input type="file" class="image-input" accept="image/*" style="display: none;" id="img-input-1">
						<label for="img-input-1" class="btn btn-sm btn-light text-primary mb-0 cursor-pointer">
							<i class="fas fa-image mr-1"></i> 이미지 추가 (선택)
						</label>
					</div>

					<div class="short-answer-block">
						<input type="text" class="form-control q-answer bg-light border-0" placeholder="정답을 입력하세요."
							style="padding: 20px;">
					</div>

					<div class="multiple-choice-block" style="display:none;">
						<div class="option-list mb-2"></div>
						<button type="button" class="btn btn-outline-primary btn-sm btn-block add-option border-dashed">
							<i class="fas fa-plus mr-1"></i> 보기 추가
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="text-right" style="max-width:900px; margin: 0 auto 20px auto;">
			<button id="add-question" class="btn btn-primary shadow-sm"
				style="border-radius: 50px; padding: 10px 25px;">
				<i class="fas fa-plus mr-1"></i> 문제 추가
			</button>
		</div>

		<hr style="max-width: 900px; margin: 30px auto;">

		<div class="submit-area d-flex justify-content-center"
			style="max-width:900px; margin:20px auto 100px auto; gap: 15px;">
			<button id="temp-save" class="btn btn-outline-secondary px-4">
				<i class="fas fa-save mr-1"></i> 임시 저장
			</button>

			<button id="load-question" class="btn btn-outline-info px-4">
				<i class="fas fa-folder-open mr-1"></i> 불러오기
			</button>

			<button id="save" class="btn btn-success shadow font-weight-bold text-nowrap px-4">
				<i class="fas fa-check mr-2"></i> 저장하기
			</button>

			<button id="remove-question" style="display:none;"></button>
		</div>
	</div>
</div>