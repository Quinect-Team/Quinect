<head>
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>

<style>
	/* ë¬¸ì œ ë¸”ë¡ ì „ì²´ */
	#question-container {
	    max-width: 900px;
	    margin: 0 auto;
	    padding: 0 20px;
	    box-sizing: border-box;
	}

	.question-block {
	    border: 1px solid #ccc;
	    padding: 20px;
	    border-radius: 8px;
	    background: #f8f9fa;
	    margin: 20px auto;
	}

	.question-block input[type="text"] {
	    padding: 8px;
	    width: 100%;
	    border: 1px solid #adb5bd;
	    border-radius: 6px;
	}
	.question-block input[type="text"]:focus {
	    outline: none;
	    border-color: #6c757d;
	    box-shadow: 0 0 0 3px rgba(108,117,125,0.25);
	}

	.choice-buttons {
	    display: flex;
	    gap: 10px;
	    margin-top: 10px;
	}
	
	/* ë¬¸ì œ ì¶”ê°€ ë²„íŠ¼ */
	.add-question-area {
	    max-width: 900px;
	    margin: 0 auto;
	    display: flex;
	    gap: 10px;
	    justify-content: flex-end;
	}
	.add-question-area button {
	    width: 150px;
	    height: 40px;
	}
	
	/* ì„ ì§€ ì¶”ê°€ ë²„íŠ¼ */
	#choices {
		padding: 8px;
		display: flex;
		margin-top: 10px;
		padding-right: 20px;
	}

	/* ë¬¸ì œ ì¶”ê°€ ë²„íŠ¼ */
	.submit-area {
	    max-width: 900px;
	    margin: 0 auto;
	    display: flex;
	    gap: 10px;
	    justify-content: flex-end;
		margin-top: 10px;
	}
	.submit-area button {
	    width: 150px;
	    height: 40px;
	}
	
	#question-sub{
		max-width: 900px;
		margin: 0 auto;
		padding: 0 20px;
		box-sizing: border-box;
	}
</style>


<!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<div id="question-sub" style="margin-bottom:20px;">
    <input type="text" id="quiz-title" placeholder="í€´ì¦ˆ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" style="width:100%; padding:10px; margin-bottom:10px;">
    <textarea id="quiz-desc" placeholder="í€´ì¦ˆ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”(ì„ íƒ)" style="width:100%; padding:10px;"></textarea>
</div>

<div id="question-container">

	<div class="question-block">
		<div class="d-flex align-items-center" style="gap:10px;">
	        <label class="q-label" for="question" style="margin:0; font-weight:bold;">Q1.</label>

	        <input type="text" name="question" placeholder="ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="flex:1;">
			
			<input type="text" name="point" placeholder="ì ìˆ˜" style="flex:0.1;">

	        <div class="btn-group dropright">
			  <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">
			    ë¬¸ì œ ìœ í˜•
			  </button>
			  <div class="dropdown-menu">
			    <a class="dropdown-item select-type" data-type="short_answer" href="#">ì„œìˆ í˜•</a>
			    <a class="dropdown-item select-type" data-type="multiple_choice" href="#">ê°ê´€ì‹</a>
			  </div>
			</div>
	    </div>

		<div class="image-container" style="margin-top:10px;">
		        <input type="file" name="image" accept="image/*">
		</div>
			
			
	    <div class="text-container" style="margin-top:10px;">
	        <input type="text" name="sub" placeholder="ì •ë‹µì„ ì‘ì„±í•˜ì„¸ìš”." style="width:100%; padding:5px;">

	    </div>
	</div>
</div>

<!-- ë¬¸ì œ ì¶”ê°€ -->
<div class="add-question-area">
    <button id="add-question" class="btn btn-secondary">ë¬¸ì œ ì¶”ê°€</button>
	<button id="load-question" class="btn btn-secondary">ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <button id="remove-question" class="btn btn-secondary">ë¬¸ì œ ì œê±°</button>
</div>
<div class="submit-area">
    <button id="temp-save" class="btn btn-secondary">ì„ì‹œ ì €ì¥</button>
    <button id="save" class="btn btn-secondary">ì €ì¥</button>
</div>

<!-- Bootstrap & Script -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
	document.addEventListener("DOMContentLoaded", () => {

	    const container = document.getElementById("question-container");

	    // ===========================================================
	    // â­ ë¬¸í•­ ì¶”ê°€
	    // ===========================================================
	    document.getElementById("add-question").addEventListener("click", () => {

	        const first = container.querySelector(".question-block");
	        const clone = first.cloneNode(true);

	        const index = container.children.length + 1;

	        // ë²ˆí˜¸ ë³€ê²½
	        clone.querySelector(".q-label").innerText = `Q${index}.`;

	        // ì…ë ¥ ì´ˆê¸°í™”
	        clone.querySelector('input[name="question"]').value = "";
	        clone.querySelector('input[name="point"]').value = "";
	        clone.querySelector('input[name="image"]').value = "";
	        clone.querySelector(".text-container").innerHTML = `
	            <input type="text" name="sub" placeholder="ì •ë‹µì„ ì‘ì„±í•˜ì„¸ìš”." style="width:100%; padding:5px;">
	        `;

	        // ê¸°ì¡´ ì‚­ì œ ë²„íŠ¼ ì œê±° í›„ ë‹¤ì‹œ ìƒì„± (Q1ì€ ì œê±°ë¨)
	        const delBtn = clone.querySelector(".delete-question");
	        if (delBtn) delBtn.remove();

	        // Q2 ì´ìƒì—ë§Œ ì‚­ì œ ë²„íŠ¼ ì¶”ê°€
	        if (index > 1) {
	            const btn = document.createElement("button");
	            btn.className = "btn btn-danger delete-question";
	            btn.innerText = "ë¬¸í•­ ì‚­ì œ";
	            btn.style.marginTop = "10px";

	            btn.addEventListener("click", () => {
	                clone.remove();
	                reIndex();
	            });

	            clone.appendChild(btn);
	        }

	        container.appendChild(clone);
	    });


	    // ===========================================================
	    // â­ ë¬¸í•­ ì¬ë²ˆí˜¸ ë¶€ì—¬
	    // ===========================================================
	    function reIndex() {
	        [...container.children].forEach((block, idx) => {
	            block.querySelector(".q-label").innerText = `Q${idx + 1}.`;

	            // Q1ì€ ì‚­ì œ ë²„íŠ¼ ì œê±°
	            const del = block.querySelector(".delete-question");
	            if (idx === 0 && del) del.remove();

	            // Q2+ëŠ” ì‚­ì œ ë²„íŠ¼ ì—†ìœ¼ë©´ ìƒì„±
	            if (idx > 0 && !del) {
	                const btn = document.createElement("button");
	                btn.className = "btn btn-danger delete-question";
	                btn.innerText = "ë¬¸í•­ ì‚­ì œ";
	                btn.style.marginTop = "10px";

	                btn.addEventListener("click", () => {
	                    block.remove();
	                    reIndex();
	                });

	                block.appendChild(btn);
	            }
	        });
	    }


	    // ===========================================================
	    // â­ ë¬¸ì œ ìœ í˜• ì „í™˜ (ì„œìˆ í˜• â†” ê°ê´€ì‹)
	    // ===========================================================
	    container.addEventListener("click", (e) => {
	        if (!e.target.classList.contains("select-type")) return;

	        const type = e.target.dataset.type;
	        const block = e.target.closest(".question-block");
	        const textContainer = block.querySelector(".text-container");

	        // ğŸ”¹ ì„œìˆ í˜•
	        if (type === "short_answer") {
	            textContainer.innerHTML = `
	                <input type="text" name="sub" placeholder="ì •ë‹µì„ ì‘ì„±í•˜ì„¸ìš”." style="width:100%; padding:5px;">
	            `;
	        }

	        // ğŸ”¹ ê°ê´€ì‹
	        if (type === "multiple_choice") {
	            const qIndex = [...container.children].indexOf(block) + 1;

	            textContainer.innerHTML = `
	                <div class="choice-item" style="display:flex; gap:5px; align-items:center; margin-bottom:5px;">
	                    <input type="radio" name="choice-${qIndex}">
	                    <input type="text" class="form-control" placeholder="ì„ ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="flex:1;">
	                    <button class="btn btn-sm btn-danger delete-choice">X</button>
	                </div>

	                <button class="btn btn-primary btn-sm add-choice" style="margin-top:5px;">ì„ ì§€ ì¶”ê°€</button>
	            `;
	        }
	    });


	    // ===========================================================
	    // â­ ê°ê´€ì‹ â€” ì„ ì§€ ì¶”ê°€ / ì‚­ì œ
	    // ===========================================================
	    container.addEventListener("click", (e) => {

	        // ğŸ”¸ ì„ ì§€ ì¶”ê°€
	        if (e.target.classList.contains("add-choice")) {

	            const block = e.target.closest(".question-block");
	            const index = [...container.children].indexOf(block) + 1;
	            const textContainer = block.querySelector(".text-container");

	            const div = document.createElement("div");
	            div.className = "choice-item";
	            div.style = "display:flex; gap:5px; align-items:center; margin-bottom:5px;";

	            div.innerHTML = `
	                <input type="radio" name="choice-${index}">
	                <input type="text" class="form-control" placeholder="ì„ ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="flex:1;">
	                <button class="btn btn-sm btn-danger delete-choice">X</button>
	            `;

	            textContainer.insertBefore(div, e.target);
	        }


	        // ğŸ”¸ ì„ ì§€ ì‚­ì œ
	        if (e.target.classList.contains("delete-choice")) {
	            e.target.closest(".choice-item").remove();
	        }
	    });


	    // ===========================================================
	    // â­ ì„ì‹œ ì €ì¥
	    // ===========================================================
	    document.getElementById("temp-save").addEventListener("click", () => {
	        localStorage.setItem("temp-questions", container.innerHTML);
	        alert("ì„ì‹œ ì €ì¥ ì™„ë£Œ!");
	    });


	    // ===========================================================
	    // â­ ë¶ˆëŸ¬ì˜¤ê¸°
	    // ===========================================================
	    document.getElementById("temp-load").addEventListener("click", () => {
	        const saved = localStorage.getItem("temp-questions");

	        if (!saved) {
	            alert("ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
	            return;
	        }

	        container.innerHTML = saved;
	        reIndex(); // ë¶ˆëŸ¬ì˜¨ ë’¤ ë²ˆí˜¸ ì¬ì •ë ¬ + ì‚­ì œë²„íŠ¼ ì¬êµ¬ì„±
	    });

	});

</script>