<!--친구창 + 채팅창 모달 팝업-->
<div class="modalPOP" th:fragment="friends">
    <div class="modalpopup bg-white rounded-lg shadow-lg" style="width: 800px; max-height: 1000px; overflow: hidden; display: flex; flex-direction: column;">

        <!-- ✅ 친구 영역 래퍼 -->
        <div id="friendsModal" style="display: flex; flex-direction: column; height: 100%;">
            <!-- 친구 헤더 -->
            <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                <h3 class="mb-0 h5 text-gray-800">
                    <i class="fas fa-user-friends mr-2 text-success"></i>친구 검색
                </h3>
                <button type="button" class="closebtn btn btn-link text-gray-600 p-0 text-decoration-none" style="font-size: 28px; line-height: 1;">
                    &times;
                </button>
            </div>

            <!-- 검색창 -->
            <div class="mb-3">
                <div class="input-group">
                    <input type="text" 
                           id="friendSearch" 
                           class="form-control" 
                           placeholder="이메일로 검색...">
                    <div class="input-group-append">
                        <button class="btn btn-success" type="button" id="searchBtn">
                            <i class="fas fa-search"></i> 검색
                        </button>
                    </div>
                </div>
            </div>

            <!-- 친구 목록 -->
            <div id="friendshipContainer" class="friends-list" style="flex: 1; overflow-y: auto; overflow-x: hidden;">
                <!-- 초기 상태 메시지 -->
                <div class="text-center py-5 text-muted">
                    <i class="fas fa-search mb-3" style="font-size: 48px; opacity: 0.3;"></i>
                    <p class="mb-1">이메일로 친구를 검색하세요</p>
                    <p class="small mb-0">검색창에 친구의 이메일을 입력해주세요.</p>
                </div>
            </div>
        </div>

		<!-- 채팅 모달 -->
		<div id="chatModal" class="modal-chat" style="display: none;">
		    <!-- 채팅 헤더 -->
		    <div class="chat-header">
		        <div>
		            <h6 id="chatFriendName" class="mb-1">친구 이름</h6>
		            <small id="chatFriendEmail" class="text-muted">이메일</small>
		        </div>
		        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="backToFriendsList()">
		            <i class="fas fa-arrow-left"></i> 뒤로
		        </button>
		    </div>
		    
		    <!-- ⭐ 메시지 히스토리 (높이 제한 + 스크롤) -->
		    <div id="messageHistory" class="message-history" style="
		        height: 400px;              /* ← 높이 제한 */
		        overflow-y: auto;           /* ← 세로 스크롤 */
		        padding: 20px;
		        background: #f9f9f9;
		        border: 1px solid #e0e0e0;
		        margin-bottom: 10px;
		    ">
		        <p class="text-center text-muted small">메시지가 없습니다.</p>
		    </div>
		    
		    <!-- 메시지 입력 -->
		    <div class="chat-input-area">
		        <div class="input-group">
		            <input 
		                type="text" 
		                id="messageInput" 
		                class="form-control" 
		                placeholder="메시지를 입력하세요..."
		                autocomplete="off"
		            >
		            <button 
		                type="button" 
		                class="btn btn-primary" 
		                onclick="sendMessage()"
		            >
		                <i class="fas fa-paper-plane"></i> 전송
		            </button>
		        </div>
		    </div>
		</div>

    </div> <!-- ✅ modalpopup 닫힘 -->
</div> <!-- modalPOP 닫힘 -->
